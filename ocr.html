<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>OCR · Terminal App</title>

  <!-- Tailwind + Material Symbols -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

</head>
<body class="flex flex-col h-screen bg-gray-50 text-gray-800">

  <header class="bg-[#1E3246] text-white p-4 shadow-md flex items-center">
    <button onclick="history.back()" class="material-symbols-outlined mr-2">arrow_back</button>
    <h1 class="text-lg font-semibold">OCR Erfassung</h1>
  </header>

  <main class="flex-1 overflow-auto p-4 space-y-4">
    <video id="cam" class="w-full max-w-md mx-auto rounded-lg shadow-md" autoplay playsinline></video>
    <button id="snap"
            class="block mx-auto mt-4 px-6 py-2 bg-[#1E3246] text-white rounded-lg shadow hover:bg-[#16314d]">
      Foto machen & OCR
    </button>
    <pre id="output" class="whitespace-pre-wrap bg-white p-4 rounded-lg shadow text-sm text-gray-700">
– noch nichts –
    </pre>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  <script>
    const video = document.getElementById('cam'),
          snapBtn = document.getElementById('snap'),
          output = document.getElementById('output');

    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }})
      .then(s => video.srcObject = s)
      .catch(_ => alert('Kamera nicht verfügbar'));

    snapBtn.addEventListener('click', async ()=>{
      // Standbild ins Canvas
      const c = document.createElement('canvas');
      c.width = video.videoWidth; c.height = video.videoHeight;
      c.getContext('2d').drawImage(video,0,0);
      output.textContent = 'OCR läuft…';

      // Tesseract OCR
      const { data:{ text }} = await Tesseract.recognize(
        c.toDataURL(), 'deu+eng',
        { logger: m => console.log(m) }
      );

      // Parsen per Regex
      let asset, sn, mon;
      for (let l of text.split('\n').map(x=>x.trim()).filter(x=>x)){
        if (!asset && /Asset[:\s]*([A-Z0-9]+)/i.test(l)) asset = RegExp.$1;
        if (!sn    && /SN[:\s]*([A-Z0-9]+)/i.test(l))    sn    = RegExp.$1;
        if (!mon   && /Monitor[:\s]*([A-Z0-9]+)/i.test(l)) mon   = RegExp.$1;
      }

      output.textContent =
        `⫸ Rohtext:\n${text}\n\n`+
        `⫸ Asset:   ${asset||'– nicht gefunden –'}\n`+
        `⫸ Rechner: ${sn   ||'– nicht gefunden –'}\n`+
        `⫸ Monitor: ${mon  ||'– nicht gefunden –'}`;
    });
  </script>
</body>
</html> 
